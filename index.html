<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Luxe Roulette · Fast Wheel</title>
<style>
  :root{
    --felt:#0A3A2E; --gold:#D8B76A; --ink:#F6F7F4;
  }
  html,body{margin:0;height:100%;background:var(--felt);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;color:var(--ink)}
  .wrap{max-width:440px;margin:0 auto;padding:14px}
  .card{border-radius:18px;padding:14px;background:
        radial-gradient(120% 140% at 50% -30%, #1c3b2f, #0b1f18);
        border:1px solid #ffffff1f; box-shadow:0 14px 40px rgba(0,0,0,.45)}
  .title{font-family:Georgia,serif;letter-spacing:.4px;color:#EAD6A0;font-weight:800;margin:0 0 8px}
  /* WHEEL */
  .stage{display:grid;place-items:center;gap:10px}
  .wheel{
    width:min(88vw,380px);height:min(88vw,380px);border-radius:50%;position:relative;overflow:hidden;
    background:radial-gradient(circle at 50% 50%, #55301d 0, #2f180e 45%, #1a0d08 70%);
    box-shadow:inset 0 0 0 12px #3b1f12,inset 0 0 0 28px #7a3e22,0 14px 30px rgba(0,0,0,.6);
    will-change: transform; transform:translateZ(0);
  }
  .wheel svg{position:absolute;inset:0;width:100%;height:100%}
  .hub{position:absolute;inset:50% auto auto 50%;transform:translate(-50%,-50%);width:28%;height:28%;border-radius:50%;
    background:radial-gradient(circle at 35% 35%, #f7e6b5, #d4b46a 55%, #a78333 70%, #6b521b);
    display:grid;place-items:center;z-index:3;box-shadow:inset 0 2px 6px rgba(255,255,255,.45),0 10px 26px rgba(0,0,0,.65)}
  .hub .badge{font:800 26px/1 Georgia,serif;color:#1c1606;background:linear-gradient(180deg,#f3e4b2,#d6b86f);padding:6px 12px;border-radius:999px;border:1px solid #0003}
  .peg{position:absolute;top:-6px;left:50%;width:12px;height:20px;transform:translateX(-50%);border-radius:6px;
    background:radial-gradient(circle at 50% 20%,#fff,#e7d48a 60%,#6d521b);box-shadow:0 6px 14px rgba(0,0,0,.65);z-index:4}
  /* BALL: sits on a separate orbit so Pi Browser always renders it */
  .orbit{position:absolute;inset:0;transform-origin:50% 50%;z-index:5;pointer-events:none;will-change:transform;transform:translateZ(0)}
  .ball{position:absolute;left:50%;top:50%;width:18px;height:18px;border-radius:50%;
    background:radial-gradient(circle at 35% 35%,#fff,#f7e5b8 60%,#caa85a); box-shadow:0 4px 8px rgba(0,0,0,.45)}
  /* UI */
  .row{display:flex;gap:10px;justify-content:center;align-items:center;margin-top:8px;flex-wrap:wrap}
  .btn{padding:14px 24px;border-radius:999px;border:1px solid #0003;background:linear-gradient(180deg,#ead79c,#d0af5b);
    color:#231a07;font-weight:900;letter-spacing:.6px;cursor:pointer;box-shadow:0 10px 18px rgba(0,0,0,.35),inset 0 -2px 0 #0003}
  .pill{padding:4px 10px;border-radius:999px;border:1px solid #ffffff22;background:#13241d;font-size:12px}
</style>
</head>
<body>
<div class="wrap card">
  <h1 class="title">ROULETTE</h1>
  <div class="stage">
    <div class="wheel" id="wheel">
      <svg viewBox="0 0 100 100" id="wheelSVG" aria-hidden="true"></svg>
      <div class="orbit" id="orbit"><div class="ball" id="ball"></div></div>
      <div class="hub"><div class="badge" id="badge">—</div></div>
      <div class="peg"></div>
    </div>
    <div class="row">
      <button class="btn" id="spin">SPIN</button>
      <span class="pill">Last: <span id="last">—</span></span>
    </div>
  </div>
</div>

<script>
/* ==================== FAST, ACCURATE WHEEL ==================== */
const ORDER=[0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,30,8,23,10,5,24,16,33,1,20,14,31,9,22,18,29,7,28,12,35,3,26];
const RED=new Set([1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36]);
const wheel = document.getElementById('wheel');
const svg = document.getElementById('wheelSVG');
const orbit = document.getElementById('orbit');
const ball = document.getElementById('ball');
const badge = document.getElementById('badge');
const lastEl = document.getElementById('last');
const spinBtn = document.getElementById('spin');

const SWEEP = 360/ORDER.length;                  // pocket degrees
let wheelAngle = 0;                               // current rotation (deg)
const BALL_ANGLE = 0;                             // screen angle where ball rests (right side)

/* Build SVG pockets + labels (one-time) */
(function buildWheel(){
  const cx=50, cy=50, rO=49, rI=32, rT=41;
  function polar(r,a){ const rad=a*Math.PI/180; return {x:cx+r*Math.cos(rad), y:cy+r*Math.sin(rad)} }
  function ann(r0,r1,a0,a1){
    const p1=polar(r1,a0), p2=polar(r1,a1), p3=polar(r0,a1), p4=polar(r0,a0);
    const la = (a1-a0)<=180 ? 0 : 1;
    return `M ${p1.x} ${p1.y} A ${r1} ${r1} 0 ${la} 1 ${p2.x} ${p2.y} L ${p3.x} ${p3.y} A ${r0} ${r0} 0 ${la} 0 ${p4.x} ${p4.y} Z`;
  }
  ORDER.forEach((n,i)=>{
    const a0=i*SWEEP-90, a1=a0+SWEEP, mid=(a0+a1)/2;
    const color = n===0 ? '#0c533f' : (RED.has(n)?'#9b1f17':'#0f0f0f');
    const path = document.createElementNS('http://www.w3.org/2000/svg','path');
    path.setAttribute('d', ann(rI,rO,a0,a1));
    path.setAttribute('fill', color);
    path.setAttribute('stroke', '#222');
    path.setAttribute('stroke-width', '0.25');
    svg.appendChild(path);

    const t = document.createElementNS('http://www.w3.org/2000/svg','text');
    const p = polar(rT, mid);
    t.setAttribute('x', p.x); t.setAttribute('y', p.y+2);
    t.setAttribute('text-anchor','middle');
    t.setAttribute('font-size','4.2'); t.setAttribute('font-weight','800');
    t.setAttribute('fill', n===0 ? '#cdebdc' : '#eaeaea');
    t.setAttribute('transform', `rotate(${mid+90},${p.x},${p.y})`);
    t.textContent = n;
    svg.appendChild(t);
  });
})();

/* Position ball on the rim (responsive) */
function placeBall(){
  const rim = wheel.offsetWidth * 0.42;        // ~fits to pockets ring
  ball.style.transform = `translate(${rim}px,-9px) translateZ(0)`; // GPU
}
addEventListener('resize', placeBall);
placeBall();

/* Helpers */
function pocketMidAngle(idx){ return (idx+0.5)*SWEEP - 90; } // SVG angle
function norm(a){ a%=360; if(a<0) a+=360; return a; }
function easeOutCubic(t){ return 1 - Math.pow(1 - t, 3); }

/* Animate wheel to land selected index under the fixed ball angle */
function spinToIndex(idx, duration=2400, onDone=()=>{}){
  const pocket = pocketMidAngle(idx);
  const deltaToBall = norm(BALL_ANGLE - pocket);   // how far to rotate so pocket center hits ball
  const targetWheel = wheelAngle + 6*360 + deltaToBall; // nice number of spins
  const from = wheelAngle, to = targetWheel;
  const start = performance.now();

  // subtle counter-motion of ball early on, returns to 0 at end (purely visual)
  function frame(now){
    const p = Math.min(1, (now - start)/duration);
    const e = easeOutCubic(p);
    const ang = from + (to - from)*e;
    wheel.style.transform = `rotate(${ang}deg) translateZ(0)`;
    orbit.style.transform = `rotate(${-(to-from)*(1-e)*0.35}deg) translateZ(0)`;
    if(p<1){ requestAnimationFrame(frame); }
    else { orbit.style.transform = 'rotate(0deg) translateZ(0)'; wheelAngle = norm(to); onDone(); }
  }
  requestAnimationFrame(frame);
}

/* Demo controls */
let spinning=false;
spinBtn.addEventListener('click', ()=>{
  if(spinning) return;
  spinning=true; spinBtn.disabled=true; spinBtn.textContent='SPINNING…';

  const idx = Math.floor(Math.random()*ORDER.length);
  const result = ORDER[idx];
  spinToIndex(idx, 2400, ()=>{
    badge.textContent = result;
    lastEl.textContent = result;
    spinBtn.disabled=false; spinBtn.textContent='SPIN'; spinning=false;
  });
});

/* Expose tiny API you can call from your Pi logic */
window.FastWheel = {
  /** Spin to an exact number (0–36). Returns true if number exists. */
  spinTo(num){
    const idx = ORDER.indexOf(Number(num));
    if(idx<0) return false;
    spinToIndex(idx, 2400, ()=>{ badge.textContent=num; lastEl.textContent=num; });
    return true;
  },
  /** Spin to a random number; returns that number immediately. */
  spinRandom(){
    const idx = Math.floor(Math.random()*ORDER.length);
    const num = ORDER[idx];
    spinToIndex(idx, 2400, ()=>{ badge.textContent=num; lastEl.textContent=num; });
    return num;
  }
};
</script>
</body>
</html>
